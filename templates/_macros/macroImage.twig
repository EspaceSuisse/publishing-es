{% macro articleImage(handleParam, transformKey, paramClass) %}

    {# Define variable #}
    {% set altText = handleParam.fPlainTextI18nMultiline %}
    {% set imgTitle = handleParam.title %}
    {% set imgphotographer = handleParam.fPlainTxt %}

    {# look up table which matches with the named transform device handle #}
    {% set deviceMap = ['desktop', 'mobile'] %}

    {# Construct the filename pattern #}
    {% set filenamePattern = imgTitle | ascii  ~ '-' ~ transformKey ~ '-EspaceSuisse' ~ '-{fullname|shorthash}.{extension}' %}

    {# Use transformKey variable instead of hardcoded value #}
    {% set transformedImages = craft.imagerx.transformImage(handleParam, transformKey, {
        filenamePattern: filenamePattern
    }) %}

    <picture class="{{ paramClass ? paramClass : 'imgItem'}}">
        {% for img in transformedImages %}
        {# Force mobile to be first in the loop #}
        {% set device = deviceMap[loop.index0] %}
            {% if device == 'mobile' %}
                <source srcset="{{ img.url }}" media="(max-width: 1080px)">
            {% else %}
                <source srcset="{{ img.url }}" media="(min-width: 1081px)">
            {% endif %}
        {% endfor %}
        <img src="{{ transformedImages[0].url }}" alt="{{ altText }}" title="{{ imgTitle }}, {{ imgphotographer }}">
    </picture>

{% endmacro %}
